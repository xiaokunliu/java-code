##### 线程使用工具
1. 测量并发使用的工具

```text
1. Lmbench3:可以测量上下问切换的时长
2. vmstat可以测量上下文切换的次数
```

2. 减少上下文切换此时

```text
1. 无锁并发编程,将数据的ID按照hash算法取模分段,不同线程处理不同段的数据,如ConcurrentHashMap
2. CAS算法,java中Atomic包
3. 使用最少线程:任务少 -- 尽量使用少线程来处理,更多线程开启只会造成线程等待,消耗更多的资源
4. 使用协程:单线程实现多任务的调度,并且在单线程里维持多个任务间的切换(Timer/ScheduledExecutor/开源工具包 Quartz/开源工具包 JCronTab)
```

3.查询进程pid下的线程正在处理什么

```text
# jstack将线程执行的过程记录导出
path/bin/jstack  pid > /path/dump
# 查询线程处于waiting状态
grep /path/dump | awk '{print $2$3$4$5}' | sort | uniq -c
# 打开导出的文件dump查看处于waiting状态的线程正在做什么
# 根据得出的结论对线程分配的资源进行重置修改
``` 

##### 锁
1. 避免死锁的常用方法

* 避免一个线程同时获取多个锁
* 避免一个线程在锁内同时占用多个资源,尽量保证每个锁只占用一个资源
* 尝试使用定时锁,使用lock.tryLock来替代使用内部锁的机制
* 对于数据库锁,加锁和解锁必须在一个数据库连接中,否则会出现解锁失败


##### 并发编程时资源的考虑

> 资源限制

```text
1. 服务器网络带宽
2. CPU以及内存大小
3. 磁盘IO读写能力
4. 数据库连接数和socket连接数
```

