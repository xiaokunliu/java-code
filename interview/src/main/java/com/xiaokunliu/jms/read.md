#### JMS

```text
面向消息的通信，应用程序中A组件把消息发送到指定的消息组件，B组件从消息组件获取消息并进行消费
分为P2P（点对点）模式和Sub/Pub（发布订阅）模式
```

> JMS优势

1. 消息采用异步处理机制，避免客户机等待
2. JMS可以持久保存消息，因而可以提高系统的可靠性
3. JMS允许一条消息同时发送给多个接收者，有效提高效率


> JMS组成部件

1. JMS服务器：路由消息的服务系统，
2. JMS生产者：负责创建并发送消息的程序组件
3. JMS消费者：负责读取并处理消息的程序组件

##### JMS消息机制模型

> P2P模型

```text
这种消息处理模型为应用程序中的各个逻辑处理单元提供可靠的通信支持，在P2P通信中，JMS把每一个消息传递给一个消息消费者，JMS系统保证消息消息传递给消息消费者，
消息不会同时被多个消费者接收，如果消费者暂时不再连接范围内，JMS系统会自动保证消息不会丢失，直到消息消费者进入连接，消息将自动送达，因此JMS系统需要将消息保存在
永久介质上，比如数据库或文件

点对点消息传递域的特点如下:
(1)每个消息只能有一个消费者 (2)消息的生产者和消费者之间没有时间上的相关性。无论消费者在生产者发送消 息的时候是否处于运行状态，它都可以提取消息

在点对点消息传递域中，目的地被称为队列(queue)
```

> 发布订阅模型

```text
每个消息被发送到一个消息Topic上，该Topic可以拥有多个订阅者，JMS系统负责将消息的副本传给该Topic的每个订阅者

发布/订阅消息传递域的特点如下:
(1)每个消息可以有多个消费者 (2)生产者和消费者之间有时间上的相关性。订阅一个主题的消费者只能消费自它 订阅之后发布的消息。
JMS 规范允许客户创建持久订阅，这在一定程度上放松了时间 上的相关性要求。持久订阅允许消费者消费它在未处于激活状态时发送的消息

在发布/订阅消息传递域中， 目的地被称为主题(topic)
```

> JMS系统对象

1. 连接工厂，由服务器管理员创建，并绑定到JNDI树上，JMS系统客户端使用JNDI进行查找，定位连接工厂，然后利用连接工厂创建JMS连接
2. JMS连接，连接表示客户机与服务器之间的活动连接，JMS通过连接工厂创建连接，JMS连接是一个相当重要的对象，通常每个客户机使用单独的连接，而每个连接则可以
连接多个JMS目的
3. JMS会话，会话表示客户机与JMS服务器之间的通信状态，JMS会话建立在连接之上，表示JMS客户端与服务器之间的通信线程，会话定义消息的顺序，JMS使用会话进行事务性的消息处理
4. JMS消息组件（Topic，队列，存储消息的文件等组件总和），即消息生产者发送消息的目的地，也是消费者获取消息的消息源
5. 消息生产者，消息生产者负责创建消息并将消息发送到消息组件中
6. 消息消费者，消息消费者负责从消息组件中接收并读取消息内容

> JMS可靠性机制

* 消息接收确认 JMS消息只有在被确认之后，才认为已经被成功地消费了。消息的成功消费通常

```text
包含三个阶段:客户接收消息、客户处理消息和消息被确认
```

* JMS消息事务

```text
当发送和消费方的事务设置为true，需要客户端进行事务的提交才能保证消息已经消费，即需要客户端进行commit操作确认消息已经消费，此时服务端将Topic或者队列中清除消息，
若设置为false，即非事务性消息，将取决于三种应答模式，
Session.AUTO_ACKNOWLEDGE：当客户成功的从receive方法返回的时候，或者从 MessageListener.onMessage方法成功返回的时候，会话自动确认客户收到的消息
Session.CLIENT_ACKNOWLEDGE：客户通过调用消息的acknowledge方法确认消 息。需要注意的是，在这种模式中，确认是在会话层上进行，确认一个被消费的消息 将自动确认所有已被会话消费的消息。例如，如果一个消息消费者消费了10 个消 息，然后确认第5 个消息，那么所有10 个消息都被确认
Session.DUPS_ACKNOWLEDGE：该选择只是会话迟钝的确认消息的提交。如果JMS provider失败，那么可能会导致一些重复的消息。如果是重复的消息，那么JMS provider 必须把消息头的JMSRedelivered字段设置为true
```

